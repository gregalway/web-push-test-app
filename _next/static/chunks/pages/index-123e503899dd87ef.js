(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5879:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return B}});var i=n(97729),r=n.n(i),o=n(2784),a=n(34366),c=n(36399),s=n(62723),u=n(83049),l=n(49718),f=n(48124),p=n(18762);const d=["title"];function b(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const w={};function m(){if(w.enableConsoleOutput){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.info("[@cbhq/web-push-notifications]: ",...t)}}function O(){if(w.enableConsoleOutput){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];console.error("[@cbhq/web-push-notifications]: ",...t)}}const j="cb-web-push-db",h=1;async function P(){return(0,p.X3)(j,h,{upgrade(e){e.createObjectStore("analytics")}})}let k=!1;const N="notifications.web";async function S(){if(k)return;const e=await async function(){return(await P()).get("analytics","config")}();if(e){const t=e.config,n=e.identity;t&&(0,f.S1)(y(y({},t),{},{platform:f.if.extension,showDebugLogging:w.enableConsoleOutput,onError:O})),n&&(0,f.yV)(n)}k=!0}async function _(e,t){null!==w&&void 0!==w&&w.isServiceWorker&&!k&&await S(),(0,f.Kz)("".concat(N,".").concat(e),t)}async function x(e){null!==w&&void 0!==w&&w.isServiceWorker&&!k&&await S(),(0,f.HR)(y(y({},e),{},{metricName:"".concat(N,".").concat(e.metricName)}))}async function E(e,t,n){var i,r,o,a;const c=function(e){var t,n;return{title:e.title,body:e.body,icon:e.icon,template:null===(t=e.data)||void 0===t?void 0:t.template,category:null===(n=e.data)||void 0===n?void 0:n.message_category}}(e);await Promise.all([_(t,y(y({},c),n)),x({metricName:t,metricType:f.t0.count,value:1,tags:{template:null!==(i=null===(r=c.template)||void 0===r?void 0:r.toString())&&void 0!==i?i:"unknown",category:null!==(o=null===(a=c.category)||void 0===a?void 0:a.toString())&&void 0!==o?o:"unknown"}})])}async function T(e,t){if(!t)return;const n=t.title,i=b(t,d);await e.showNotification(null!==n&&void 0!==n?n:"",i)}function C(){return"Notification"in window||(O("Notifications not supported in this browser"),!1)}function W(){return!!C()&&"granted"===Notification.permission}function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let L=null;function R(e){const t=(0,l.KL)();(0,l.ps)(t,(t=>{let{notification:n}=t;n&&(T(e,n),function(e,t){const n=null!==w&&void 0!==w&&w.isServiceWorker?"background":"foreground";switch(m("Notification event:",{event:e,notification:t,context:n}),e){case"delivered":E(t,"delivered",{action:f.Us.measurement,componentType:f.re.service_worker,context:n});break;case"clicked":E(t,"clicked",{action:f.Us.click,componentType:f.re.service_worker,context:n});break;default:O("Unhandled notification event: ".concat(e))}}("delivered",n))}))}async function U(e,t){if(!(await(0,l.Gb)()))return O("Failed to initialize, web push is not supported in this browser"),null;if(!W())return O("Failed to initialize, push permissions are not granted"),null;var n;n=I(I({},t),{},{isServiceWorker:!1}),Object.assign(w,n);const i=w.vapidKey,r=w.firebaseConfig;await e.update(),await async function(e){return new Promise((t=>{let n;e.installing?n=e.installing:e.waiting?n=e.waiting:e.active&&(n=e.active),n&&("activated"===n.state&&t(),n.addEventListener("statechange",(e=>{var n;m("Waiting for service worker to activate..."),"activated"===(null===(n=e.target)||void 0===n?void 0:n.state)&&(m("Service worker ready"),t())})))}))}(e),L=e,f.vc&&await async function(e){const t=await P();await t.put("analytics",e,"config")}({config:{projectName:f.vc.projectName,isProd:f.vc.isProd,version:f.vc.version,amplitudeApiKey:f.vc.amplitudeApiKey},identity:I(I({},f.yR),{},{userTypeEnum:f.yR.userTypeEnum})});try{const t=(0,u.ZF)(r),n=(0,l.KL)(t),o=await(0,l.LP)(n,{vapidKey:i,serviceWorkerRegistration:e});return R(e),m("Firebase token:",o),o}catch(o){return"failed to get token"}}const z={apiKey:"AIzaSyCR6IoCUQ5Em7z695X4YT2rNN5SabIZPYc",authDomain:"testing-pwa-16aa0.firebaseapp.com",projectId:"testing-pwa-16aa0",messagingSenderId:"956053544244",appId:"1:956053544244:web:45cb94738abeb014631961"},A="BJwXFHi_floI-_83-x2YGl38sLaOnsZhPd_MRKNrhvxGv-NjFPSWb9zHV2oa14LwTl4eWHQHR7rj13c0wU6lneU";var F=n(5632);function H(e){const{0:t,1:i}=(0,o.useState)(""),r=(0,F.useRouter)();(0,o.useEffect)((function(){if(!e)return;(async()=>{const e=await navigator.serviceWorker.register(n.tu(new URL(n.p+n.u(45),n.b))),t=await U(e,{firebaseConfig:z,vapidKey:A,enableConsoleOutput:!0});t&&i(t)})()}),[e,r.push]);return{token:t,sendNotification:(0,o.useCallback)((()=>{!async function(e){m("Showing local notification:",e),L&&await T(L,e)}({title:"Local notification!",body:"testing our notification",data:{url:"".concat(window.origin,"/foo"),message_id:"your_internal_unique_message_id_for_tracking"}})}),[])}}var X=n(52322);function q(){const{0:e,1:t}=(0,o.useState)(!1);(0,o.useEffect)((()=>{t(W())}),[]);const n=(0,o.useCallback)((async()=>{await async function(){return!!C()&&"granted"===await Notification.requestPermission()}()&&t(!0)}),[]),{token:i,sendNotification:r}=H(e);return(0,X.jsx)(s.Box,{alignItems:"center",justifyContent:"center",spacing:4,children:(0,X.jsxs)(s.VStack,{maxWidth:"500px",flexGrow:1,gap:1,children:[(0,X.jsx)(a.Button,{disabled:!!e,onPress:n,children:"Enable Notifications"}),(0,X.jsx)(a.Button,{disabled:!e,onPress:r,children:"Send Local Notification"}),(0,X.jsx)(c.TextInput,{disabled:!0,label:"Push Token",placeholder:"waiting for push token",value:i})]})})}function B(){return(0,X.jsxs)("div",{className:"container",children:[(0,X.jsxs)(r(),{children:[(0,X.jsx)("title",{children:"Web Notification Test App"}),(0,X.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,X.jsx)("link",{rel:"manifest",href:"/manifest.json"})]}),(0,X.jsx)(q,{})]})}},87314:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5879)}])}},function(e){e.O(0,[205,565,888,774,179],(function(){return t=87314,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=index-123e503899dd87ef.js.map