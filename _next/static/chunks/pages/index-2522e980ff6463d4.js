(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{5879:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return G}});var i=n(97729),r=n.n(i),o=n(2784),a=n(34366),c=n(36399),s=n(62723),u=n(83049),l=n(49718),f=n(48124),p=n(18762);const d=["title"];function b(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},o=Object.keys(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)n=o[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const g={};function m(){if(g.enableConsoleOutput){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.info("[@cbhq/web-push-notifications]: ",...e)}}function O(){if(g.enableConsoleOutput){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];console.error("[@cbhq/web-push-notifications]: ",...e)}}const j="cb-web-push-db",h=1;async function P(){return(0,p.X3)(j,h,{upgrade(t){t.createObjectStore("analytics")}})}let k=!1;const N="notifications.web";async function S(){if(k)return;const t=await async function(){return(await P()).get("analytics","config")}();if(t){const e=t.config,n=t.identity;e&&(0,f.S1)(y(y({},e),{},{platform:f.if.extension,showDebugLogging:g.enableConsoleOutput,onError:O})),n&&(0,f.yV)(n)}k=!0}async function x(t,e){null!==g&&void 0!==g&&g.isServiceWorker&&!k&&await S(),(0,f.Kz)("".concat(N,".").concat(t),e)}async function E(t){null!==g&&void 0!==g&&g.isServiceWorker&&!k&&await S(),(0,f.HR)(y(y({},t),{},{metricName:"".concat(N,".").concat(t.metricName)}))}async function _(t,e,n){var i,r,o,a;const c=function(t){var e,n;return{title:t.title,body:t.body,icon:t.icon,template:null===(e=t.data)||void 0===e?void 0:e.template,category:null===(n=t.data)||void 0===n?void 0:n.message_category}}(t);await Promise.all([x(e,y(y({},c),n)),E({metricName:e,metricType:f.t0.count,value:1,tags:{template:null!==(i=null===(r=c.template)||void 0===r?void 0:r.toString())&&void 0!==i?i:"unknown",category:null!==(o=null===(a=c.category)||void 0===a?void 0:a.toString())&&void 0!==o?o:"unknown"}})])}async function T(t,e){if(!e)return;const n=e.title,i=b(e,d);await t.showNotification(null!==n&&void 0!==n?n:"",i)}function C(){return"Notification"in window||(O("Notifications not supported in this browser"),!1)}function W(){return!!C()&&"granted"===Notification.permission}function D(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?D(Object(n),!0).forEach((function(e){K(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function K(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}let L=null;function R(t){const e=(0,l.KL)();(0,l.ps)(e,(e=>{let{notification:n}=e;n&&(T(t,n),function(t,e){const n=null!==g&&void 0!==g&&g.isServiceWorker?"background":"foreground";switch(m("Notification event:",{event:t,notification:e,context:n}),t){case"delivered":_(e,"delivered",{action:f.Us.measurement,componentType:f.re.service_worker,context:n});break;case"clicked":_(e,"clicked",{action:f.Us.click,componentType:f.re.service_worker,context:n});break;default:O("Unhandled notification event: ".concat(t))}}("delivered",n))}))}async function U(t,e){if(!(await(0,l.Gb)()))return O("Failed to initialize, web push is not supported in this browser"),null;if(!W())return O("Failed to initialize, push permissions are not granted"),null;var n;n=I(I({},e),{},{isServiceWorker:!1}),Object.assign(g,n);const i=g.vapidKey,r=g.firebaseConfig;await t.update(),await async function(t){return new Promise((e=>{let n;t.installing?n=t.installing:t.waiting?n=t.waiting:t.active&&(n=t.active),n&&("activated"===n.state&&e(),n.addEventListener("statechange",(t=>{var n;m("Waiting for service worker to activate..."),"activated"===(null===(n=t.target)||void 0===n?void 0:n.state)&&(m("Service worker ready"),e())})))}))}(t),L=t,f.vc&&await async function(t){const e=await P();await e.put("analytics",t,"config")}({config:{projectName:f.vc.projectName,isProd:f.vc.isProd,version:f.vc.version,amplitudeApiKey:f.vc.amplitudeApiKey},identity:I(I({},f.yR),{},{userTypeEnum:f.yR.userTypeEnum})});try{const e=(0,u.ZF)(r),n=(0,l.KL)(e),o=await(0,l.LP)(n,{vapidKey:i,serviceWorkerRegistration:t});return R(t),m("Firebase token:",o),o}catch(o){return"failed to get token"}}const z={apiKey:"AIzaSyCR6IoCUQ5Em7z695X4YT2rNN5SabIZPYc",authDomain:"testing-pwa-16aa0.firebaseapp.com",projectId:"testing-pwa-16aa0",messagingSenderId:"956053544244",appId:"1:956053544244:web:45cb94738abeb014631961"},A="BJwXFHi_floI-_83-x2YGl38sLaOnsZhPd_MRKNrhvxGv-NjFPSWb9zHV2oa14LwTl4eWHQHR7rj13c0wU6lneU";var F=n(5632);function H(t){const{0:e,1:i}=(0,o.useState)(""),r=(0,F.useRouter)();(0,o.useEffect)((function(){if(!t)return;(async()=>{const t=await navigator.serviceWorker.register(n.tu(new URL(n.p+n.u(45),n.b))),e=await U(t,{firebaseConfig:z,vapidKey:A,enableConsoleOutput:!0});e&&i(e)})()}),[t,r.push]);return{token:e,sendNotification:(0,o.useCallback)((()=>{!async function(t){m("Showing local notification:",t),L&&await T(L,t)}({title:"Local notification!",body:"testing our notification",data:{url:"".concat(window.location,"/foo")}})}),[])}}var X=n(52322);function B(){const{0:t,1:e}=(0,o.useState)(!1);(0,o.useEffect)((()=>{e(W())}),[]);const n=(0,o.useCallback)((async()=>{await async function(){return!!C()&&"granted"===await Notification.requestPermission()}()&&e(!0)}),[]),{token:i,sendNotification:r}=H(t);return(0,X.jsx)(s.Box,{alignItems:"center",justifyContent:"center",spacing:4,children:(0,X.jsxs)(s.VStack,{maxWidth:"500px",flexGrow:1,gap:1,children:[(0,X.jsx)(a.Button,{disabled:!!t,onPress:n,children:"Enable Notifications"}),(0,X.jsx)(a.Button,{disabled:!t,onPress:r,children:"Send Local Notification"}),(0,X.jsx)(c.TextInput,{disabled:!0,label:"Push Token",placeholder:"waiting for push token",value:i})]})})}function G(){return(0,X.jsxs)("div",{className:"container",children:[(0,X.jsxs)(r(),{children:[(0,X.jsx)("title",{children:"Web Notification Test App"}),(0,X.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,X.jsx)("link",{rel:"manifest",href:"/manifest.json"})]}),(0,X.jsx)(B,{})]})}},87314:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(5879)}])}},function(t){t.O(0,[205,565,888,774,179],(function(){return e=87314,t(t.s=e);var e}));var e=t.O();_N_E=e}]);
//# sourceMappingURL=index-2522e980ff6463d4.js.map